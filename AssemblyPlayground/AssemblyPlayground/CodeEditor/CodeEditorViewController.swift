//
//  CodeEditorViewController.swift
//  AssemblyPlayground
//
//  Created by Felix Wehnert on 21.08.18.
//  Copyright Â© 2018 Felix Wehnert. All rights reserved.
//

import Cocoa

class CodeEditorViewController: NSViewController {

    @IBOutlet var sourceTextView: CodeEditor!
    
    var assembly: String {
        return attributedSourceCode.string
    }
    
    @objc var attributedSourceCode: NSAttributedString = NSAttributedString(string: "") {
        didSet {
            (NSDocumentController.shared.currentDocument as? Document)?.data.assembly = self.assembly
        }
    }
    
    override func viewWillAppear() {
        
        if let assembly = (NSDocumentController.shared.currentDocument as? Document)?.data.assembly {
            self.setValue(NSAttributedString(string: assembly), forKey: "attributedSourceCode")
        }
        
        let keywords: [String] = ["AAA","AAD","AAM","AAS","ADC","ADCX","ADD","ADDPD","ADDPS","ADDSD","ADDSS","ADDSUBPD","ADDSUBPS","ADOX","AESDEC","AESDECLAST","AESENC","AESENCLAST","AESIMC","AESKEYGENASSIST","AND","ANDN","ANDNPD","ANDNPS","ANDPD","ANDPS","ARPL","BEXTR","BLENDPD","BLENDPS","BLENDVPD","BLENDVPS","BLSI","BLSMSK","BLSR","BNDCL","BNDCN","BNDCU","BNDLDX","BNDMK","BNDMOV","BNDSTX","BOUND","BSF","BSR","BSWAP","BT","BTC","BTR","BTS","BZHI","CALL","CBW","CDQ","CDQE","CLAC","CLC","CLD","CLFLUSH","CLFLUSHOPT","CLI","CLTS","CLWB","CMC","CMOVCC","CMP","CMPPD","CMPPS","CMPS","CMPSB","CMPSD","CMPSD","CMPSQ","CMPSS","CMPSW","CMPXCHG","CMPXCHG16B","CMPXCHG8B","COMISD","COMISS","CPUID","CQO","CRC32","CVTDQ2PD","CVTDQ2PS","CVTPD2DQ","CVTPD2PI","CVTPD2PS","CVTPI2PD","CVTPI2PS","CVTPS2DQ","CVTPS2PD","CVTPS2PI","CVTSD2SI","CVTSD2SS","CVTSI2SD","CVTSI2SS","CVTSS2SD","CVTSS2SI","CVTTPD2DQ","CVTTPD2PI","CVTTPS2DQ","CVTTPS2PI","CVTTSD2SI","CVTTSS2SI","CWD","CWDE","DAA","DAS","DEC","DIV","DIVPD","DIVPS","DIVSD","DIVSS","DPPD","DPPS","EMMS","ENTER","EXTRACTPS","F2XM1","FABS","FADD","FADDP","FBLD","FBSTP","FCHS","FCLEX","FCMOVCC","FCOM","FCOMI","FCOMIP","FCOMP","FCOMPP","FCOS","FDECSTP","FDIV","FDIVP","FDIVR","FDIVRP","FFREE","FIADD","FICOM","FICOMP","FIDIV","FIDIVR","FILD","FIMUL","FINCSTP","FINIT","FIST","FISTP","FISTTP","FISUB","FISUBR","FLD","FLD1","FLDCW","FLDENV","FLDL2E","FLDL2T","FLDLG2","FLDLN2","FLDPI","FLDZ","FMUL","FMULP","FNCLEX","FNINIT","FNOP","FNSAVE","FNSTCW","FNSTENV","FNSTSW","FPATAN","FPREM","FPREM1","FPTAN","FRNDINT","FRSTOR","FSAVE","FSCALE","FSIN","FSINCOS","FSQRT","FST","FSTCW","FSTENV","FSTP","FSTSW","FSUB","FSUBP","FSUBR","FSUBRP","FTST","FUCOM","FUCOMI","FUCOMIP","FUCOMP","FUCOMPP","FWAIT","FXAM","FXCH","FXRSTOR","FXSAVE","FXTRACT","FYL2X","FYL2XP1","HADDPD","HADDPS","HLT","HSUBPD","HSUBPS","IDIV","IMUL","IN","INC","INS","INSB","INSD","INSERTPS","INSW","INT","INT1","INT3","INTO","INVD","INVLPG","INVPCID","IRET","IRETD","JMP","JCC","KADDB","KADDD","KADDQ","KADDW","KANDB","KANDD","KANDNB","KANDND","KANDNQ","KANDNW","KANDQ","KANDW","KMOVB","KMOVD","KMOVQ","KMOVW","KNOTB","KNOTD","KNOTQ","KNOTW","KORB","KORD","KORQ","KORTESTB","KORTESTD","KORTESTQ","KORTESTW","KORW","KSHIFTLB","KSHIFTLD","KSHIFTLQ","KSHIFTLW","KSHIFTRB","KSHIFTRD","KSHIFTRQ","KSHIFTRW","KTESTB","KTESTD","KTESTQ","KTESTW","KUNPCKBW","KUNPCKDQ","KUNPCKWD","KXNORB","KXNORD","KXNORQ","KXNORW","KXORB","KXORD","KXORQ","KXORW","LAHF","LAR","LDDQU","LDMXCSR","LDS","LEA","LEAVE","LES","LFENCE","LFS","LGDT","LGS","LIDT","LLDT","LMSW","LOCK","LODS","LODSB","LODSD","LODSQ","LODSW","LOOP","LOOPCC","LSL","LSS","LTR","LZCNT","MASKMOVDQU","MASKMOVQ","MAXPD","MAXPS","MAXSD","MAXSS","MFENCE","MINPD","MINPS","MINSD","MINSS","MONITOR","MOV","MOV","MOV","MOVAPD","MOVAPS","MOVBE","MOVD","MOVDDUP","MOVDQ2Q","MOVDQA","MOVDQU","MOVHLPS","MOVHPD","MOVHPS","MOVLHPS","MOVLPD","MOVLPS","MOVMSKPD","MOVMSKPS","MOVNTDQ","MOVNTDQA","MOVNTI","MOVNTPD","MOVNTPS","MOVNTQ","MOVQ","MOVQ","MOVQ2DQ","MOVS","MOVSB","MOVSD","MOVSD","MOVSHDUP","MOVSLDUP","MOVSQ","MOVSS","MOVSW","MOVSX","MOVSXD","MOVUPD","MOVUPS","MOVZX","MPSADBW","MUL","MULPD","MULPS","MULSD","MULSS","MULX","MWAIT","NEG","NOP","NOT","OR","ORPD","ORPS","OUT","OUTS","OUTSB","OUTSD","OUTSW","PABSB","PABSD","PABSQ","PABSW","PACKSSDW","PACKSSWB","PACKUSDW","PACKUSWB","PADDB","PADDD","PADDQ","PADDSB","PADDSW","PADDUSB","PADDUSW","PADDW","PALIGNR","PAND","PANDN","PAUSE","PAVGB","PAVGW","PBLENDVB","PBLENDW","PCLMULQDQ","PCMPEQB","PCMPEQD","PCMPEQQ","PCMPEQW","PCMPESTRI","PCMPESTRM","PCMPGTB","PCMPGTD","PCMPGTQ","PCMPGTW","PCMPISTRI","PCMPISTRM","PDEP","PEXT","PEXTRB","PEXTRD","PEXTRQ","PEXTRW","PHADDD","PHADDSW","PHADDW","PHMINPOSUW","PHSUBD","PHSUBSW","PHSUBW","PINSRB","PINSRD","PINSRQ","PINSRW","PMADDUBSW","PMADDWD","PMAXSB","PMAXSD","PMAXSQ","PMAXSW","PMAXUB","PMAXUD","PMAXUQ","PMAXUW","PMINSB","PMINSD","PMINSQ","PMINSW","PMINUB","PMINUD","PMINUQ","PMINUW","PMOVMSKB","PMOVSX","PMOVZX","PMULDQ","PMULHRSW","PMULHUW","PMULHW","PMULLD","PMULLQ","PMULLW","PMULUDQ","POP","POPA","POPAD","POPCNT","POPF","POPFD","POPFQ","POR","PREFETCHW","PREFETCHH","PSADBW","PSHUFB","PSHUFD","PSHUFHW","PSHUFLW","PSHUFW","PSIGNB","PSIGND","PSIGNW","PSLLD","PSLLDQ","PSLLQ","PSLLW","PSRAD","PSRAQ","PSRAW","PSRLD","PSRLDQ","PSRLQ","PSRLW","PSUBB","PSUBD","PSUBQ","PSUBSB","PSUBSW","PSUBUSB","PSUBUSW","PSUBW","PTEST","PTWRITE","PUNPCKHBW","PUNPCKHDQ","PUNPCKHQDQ","PUNPCKHWD","PUNPCKLBW","PUNPCKLDQ","PUNPCKLQDQ","PUNPCKLWD","PUSH","PUSHA","PUSHAD","PUSHF","PUSHFD","PUSHFQ","PXOR","RCL","RCPPS","RCPSS","RCR","RDFSBASE","RDGSBASE","RDMSR","RDPID","RDPKRU","RDPMC","RDRAND","RDSEED","RDTSC","RDTSCP","REP","REPE","REPNE","REPNZ","REPZ","RET","ROL","ROR","RORX","ROUNDPD","ROUNDPS","ROUNDSD","ROUNDSS","RSM","RSQRTPS","RSQRTSS","SAHF","SAL","SAR","SARX","SBB","SCAS","SCASB","SCASD","SCASW","SETCC","SFENCE","SGDT","SHA1MSG1","SHA1MSG2","SHA1NEXTE","SHA1RNDS4","SHA256MSG1","SHA256MSG2","SHA256RNDS2","SHL","SHLD","SHLX","SHR","SHRD","SHRX","SHUFPD","SHUFPS","SIDT","SLDT","SMSW","SQRTPD","SQRTPS","SQRTSD","SQRTSS","STAC","STC","STD","STI","STMXCSR","STOS","STOSB","STOSD","STOSQ","STOSW","STR","SUB","SUBPD","SUBPS","SUBSD","SUBSS","SWAPGS","SYSCALL","SYSENTER","SYSEXIT","SYSRET","TEST","TZCNT","UCOMISD","UCOMISS","UD","UNPCKHPD","UNPCKHPS","UNPCKLPD","UNPCKLPS","VALIGND","VALIGNQ","VBLENDMPD","VBLENDMPS","VBROADCAST","VCOMPRESSPD","VCOMPRESSPS","VCVTPD2QQ","VCVTPD2UDQ","VCVTPD2UQQ","VCVTPH2PS","VCVTPS2PH","VCVTPS2QQ","VCVTPS2UDQ","VCVTPS2UQQ","VCVTQQ2PD","VCVTQQ2PS","VCVTSD2USI","VCVTSS2USI","VCVTTPD2QQ","VCVTTPD2UDQ","VCVTTPD2UQQ","VCVTTPS2QQ","VCVTTPS2UDQ","VCVTTPS2UQQ","VCVTTSD2USI","VCVTTSS2USI","VCVTUDQ2PD","VCVTUDQ2PS","VCVTUQQ2PD","VCVTUQQ2PS","VCVTUSI2SD","VCVTUSI2SS","VDBPSADBW","VERR","VERW","VEXPANDPD","VEXPANDPS","VEXTRACTF128","VEXTRACTF32X4","VEXTRACTF32X8","VEXTRACTF64X2","VEXTRACTF64X4","VEXTRACTI128","VEXTRACTI32X4","VEXTRACTI32X8","VEXTRACTI64X2","VEXTRACTI64X4","VFIXUPIMMPD","VFIXUPIMMPS","VFIXUPIMMSD","VFIXUPIMMSS","VFMADD132PD","VFMADD132PS","VFMADD132SD","VFMADD132SS","VFMADD213PD","VFMADD213PS","VFMADD213SD","VFMADD213SS","VFMADD231PD","VFMADD231PS","VFMADD231SD","VFMADD231SS","VFMADDSUB132PD","VFMADDSUB132PS","VFMADDSUB213PD","VFMADDSUB213PS","VFMADDSUB231PD","VFMADDSUB231PS","VFMSUB132PD","VFMSUB132PS","VFMSUB132SD","VFMSUB132SS","VFMSUB213PD","VFMSUB213PS","VFMSUB213SD","VFMSUB213SS","VFMSUB231PD","VFMSUB231PS","VFMSUB231SD","VFMSUB231SS","VFMSUBADD132PD","VFMSUBADD132PS","VFMSUBADD213PD","VFMSUBADD213PS","VFMSUBADD231PD","VFMSUBADD231PS","VFNMADD132PD","VFNMADD132PS","VFNMADD132SD","VFNMADD132SS","VFNMADD213PD","VFNMADD213PS","VFNMADD213SD","VFNMADD213SS","VFNMADD231PD","VFNMADD231PS","VFNMADD231SD","VFNMADD231SS","VFNMSUB132PD","VFNMSUB132PS","VFNMSUB132SD","VFNMSUB132SS","VFNMSUB213PD","VFNMSUB213PS","VFNMSUB213SD","VFNMSUB213SS","VFNMSUB231PD","VFNMSUB231PS","VFNMSUB231SD","VFNMSUB231SS","VFPCLASSPD","VFPCLASSPS","VFPCLASSSD","VFPCLASSSS","VGATHERDPD","VGATHERDPD","VGATHERDPS","VGATHERDPS","VGATHERQPD","VGATHERQPD","VGATHERQPS","VGATHERQPS","VGETEXPPD","VGETEXPPS","VGETEXPSD","VGETEXPSS","VGETMANTPD","VGETMANTPS","VGETMANTSD","VGETMANTSS","VINSERTF128","VINSERTF32X4","VINSERTF32X8","VINSERTF64X2","VINSERTF64X4","VINSERTI128","VINSERTI32X4","VINSERTI32X8","VINSERTI64X2","VINSERTI64X4","VMASKMOV","VMOVDQA32","VMOVDQA64","VMOVDQU16","VMOVDQU32","VMOVDQU64","VMOVDQU8","VPBLENDD","VPBLENDMB","VPBLENDMD","VPBLENDMQ","VPBLENDMW","VPBROADCAST","VPBROADCASTB","VPBROADCASTD","VPBROADCASTM","VPBROADCASTQ","VPBROADCASTW","VPCMPB","VPCMPD","VPCMPQ","VPCMPUB","VPCMPUD","VPCMPUQ","VPCMPUW","VPCMPW","VPCOMPRESSD","VPCOMPRESSQ","VPCONFLICTD","VPCONFLICTQ","VPERM2F128","VPERM2I128","VPERMB","VPERMD","VPERMI2B","VPERMI2D","VPERMI2PD","VPERMI2PS","VPERMI2Q","VPERMI2W","VPERMILPD","VPERMILPS","VPERMPD","VPERMPS","VPERMQ","VPERMT2B","VPERMT2D","VPERMT2PD","VPERMT2PS","VPERMT2Q","VPERMT2W","VPERMW","VPEXPANDD","VPEXPANDQ","VPGATHERDD","VPGATHERDD","VPGATHERDQ","VPGATHERDQ","VPGATHERQD","VPGATHERQD","VPGATHERQQ","VPGATHERQQ","VPLZCNTD","VPLZCNTQ","VPMADD52HUQ","VPMADD52LUQ","VPMASKMOV","VPMOVB2M","VPMOVD2M","VPMOVDB","VPMOVDW","VPMOVM2B","VPMOVM2D","VPMOVM2Q","VPMOVM2W","VPMOVQ2M","VPMOVQB","VPMOVQD","VPMOVQW","VPMOVSDB","VPMOVSDW","VPMOVSQB","VPMOVSQD","VPMOVSQW","VPMOVSWB","VPMOVUSDB","VPMOVUSDW","VPMOVUSQB","VPMOVUSQD","VPMOVUSQW","VPMOVUSWB","VPMOVW2M","VPMOVWB","VPMULTISHIFTQB","VPROLD","VPROLQ","VPROLVD","VPROLVQ","VPRORD","VPRORQ","VPRORVD","VPRORVQ","VPSCATTERDD","VPSCATTERDQ","VPSCATTERQD","VPSCATTERQQ","VPSLLVD","VPSLLVQ","VPSLLVW","VPSRAVD","VPSRAVQ","VPSRAVW","VPSRLVD","VPSRLVQ","VPSRLVW","VPTERNLOGD","VPTERNLOGQ","VPTESTMB","VPTESTMD","VPTESTMQ","VPTESTMW","VPTESTNMB","VPTESTNMD","VPTESTNMQ","VPTESTNMW","VRANGEPD","VRANGEPS","VRANGESD","VRANGESS","VRCP14PD","VRCP14PS","VRCP14SD","VRCP14SS","VREDUCEPD","VREDUCEPS","VREDUCESD","VREDUCESS","VRNDSCALEPD","VRNDSCALEPS","VRNDSCALESD","VRNDSCALESS","VRSQRT14PD","VRSQRT14PS","VRSQRT14SD","VRSQRT14SS","VSCALEFPD","VSCALEFPS","VSCALEFSD","VSCALEFSS","VSCATTERDPD","VSCATTERDPS","VSCATTERQPD","VSCATTERQPS","VSHUFF32X4","VSHUFF64X2","VSHUFI32X4","VSHUFI64X2","VTESTPD","VTESTPS","VZEROALL","VZEROUPPER","WAIT","WBINVD","WRFSBASE","WRGSBASE","WRMSR","WRPKRU","XABORT","XACQUIRE","XADD","XBEGIN","XCHG","XEND","XGETBV","XLAT","XLATB","XOR","XORPD","XORPS","XRELEASE","XRSTOR","XRSTORS","XSAVE","XSAVEC","XSAVEOPT","XSAVES","XSETBV","XTEST"]
        
        let registers = [
        /* x86 */ "AH","AL","AX","BH","BL","BP","BPL","BX","CH","CL","CS","CX","DH","DI","DIL","DL","DS","DX","EAX","EBP","EBX","ECX","EDI","EDX","EFLAGS","EIP","EIZ","ES","ESI","ESP","FPSW","FS","GS","IP","RAX","RBP","RBX","RCX","RDI","RDX","RIP","RIZ","RSI","RSP","SI","SIL","SP","SPL","SS","CR0","CR1","CR2","CR3","CR4","CR5","CR6","CR7","CR8","CR9","CR10","CR11","CR12","CR13","CR14","CR15","DR0","DR1","DR2","DR3","DR4","DR5","DR6","DR7","DR8","DR9","DR10","DR11","DR12","DR13","DR14","DR15","FP0","FP1","FP2","FP3","FP4","FP5","FP6","FP7","K0","K1","K2","K3","K4","K5","K6","K7","MM0","MM1","MM2","MM3","MM4","MM5","MM6","MM7","R8","R9","R10","R11","R12","R13","R14","R15","ST0","ST1","ST2","ST3","ST4","ST5","ST6","ST7","XMM0","XMM1","XMM2","XMM3","XMM4","XMM5","XMM6","XMM7","XMM8","XMM9","XMM10","XMM11","XMM12","XMM13","XMM14","XMM15","XMM16","XMM17","XMM18","XMM19","XMM20","XMM21","XMM22","XMM23","XMM24","XMM25","XMM26","XMM27","XMM28","XMM29","XMM30","XMM31","YMM0","YMM1","YMM2","YMM3","YMM4","YMM5","YMM6","YMM7","YMM8","YMM9","YMM10","YMM11","YMM12","YMM13","YMM14","YMM15","YMM16","YMM17","YMM18","YMM19","YMM20","YMM21","YMM22","YMM23","YMM24","YMM25","YMM26","YMM27","YMM28","YMM29","YMM30","YMM31","ZMM0","ZMM1","ZMM2","ZMM3","ZMM4","ZMM5","ZMM6","ZMM7","ZMM8","ZMM9","ZMM10","ZMM11","ZMM12","ZMM13","ZMM14","ZMM15","ZMM16","ZMM17","ZMM18","ZMM19","ZMM20","ZMM21","ZMM22","ZMM23","ZMM24","ZMM25","ZMM26","ZMM27","ZMM28","ZMM29","ZMM30","ZMM31","R8B","R9B","R10B","R11B","R12B","R13B","R14B","R15B","R8D","R9D","R10D","R11D","R12D","R13D","R14D","R15D","R8W","R9W","R10W","R11W","R12W","R13W","R14W","R15W","IDTR","GDTR","LDTR","TR","FPCW","FPTAG","MSR",
        /* arm64 */ "X29","X30","NZCV","SP","WSP","WZR","XZR","B0","B1","B2","B3","B4","B5","B6","B7","B8","B9","B10","B11","B12","B13","B14","B15","B16","B17","B18","B19","B20","B21","B22","B23","B24","B25","B26","B27","B28","B29","B30","B31","D0","D1","D2","D3","D4","D5","D6","D7","D8","D9","D10","D11","D12","D13","D14","D15","D16","D17","D18","D19","D20","D21","D22","D23","D24","D25","D26","D27","D28","D29","D30","D31","H0","H1","H2","H3","H4","H5","H6","H7","H8","H9","H10","H11","H12","H13","H14","H15","H16","H17","H18","H19","H20","H21","H22","H23","H24","H25","H26","H27","H28","H29","H30","H31","Q0","Q1","Q2","Q3","Q4","Q5","Q6","Q7","Q8","Q9","Q10","Q11","Q12","Q13","Q14","Q15","Q16","Q17","Q18","Q19","Q20","Q21","Q22","Q23","Q24","Q25","Q26","Q27","Q28","Q29","Q30","Q31","S0","S1","S2","S3","S4","S5","S6","S7","S8","S9","S10","S11","S12","S13","S14","S15","S16","S17","S18","S19","S20","S21","S22","S23","S24","S25","S26","S27","S28","S29","S30","S31","W0","W1","W2","W3","W4","W5","W6","W7","W8","W9","W10","W11","W12","W13","W14","W15","W16","W17","W18","W19","W20","W21","W22","W23","W24","W25","W26","W27","W28","W29","W30","X0","X1","X2","X3","X4","X5","X6","X7","X8","X9","X10","X11","X12","X13","X14","X15","X16","X17","X18","X19","X20","X21","X22","X23","X24","X25","X26","X27","X28","V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","V14","V15","V16","V17","V18","V19","V20","V21","V22","V23","V24","V25","V26","V27","V28","V29","V30","V31","PC","CPACR_EL1","TPIDR_EL0","TPIDRRO_EL0","TPIDR_EL1"]
        
        let registerSet = Set(registers)
        let keywordSet = Set(keywords)
        
        sourceTextView.colorSet = [keywordSet: NSColor.red, registerSet: NSColor.green]
        
    }
    
}
